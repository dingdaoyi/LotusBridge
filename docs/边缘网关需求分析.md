## 边缘网关是否需要添加物模型?

在边缘设备中，一个网关通常只是一个设备或几个设备的集合。因此，将产品和物模型直接引入边缘网关可能没有太大的实际意义。如果需要这些功能，可以考虑在边缘网关的背向输出中构建一个服务，包括简单的产品物模型和设备告警等信息。此后可以根据需求进一步决定。

## 边缘网关的功能

![image-20230701160927257](https://yanbingmd.oss-cn-chengdu.aliyuncs.com/md/image-20230701160927257.png)

在网关添加设备时，需要确定该设备下的数据是多个点位的数据（例如，一套压力系统，采集每个点位的压力）还是一个设备上的多种数据。我们可以先按照细水雾的处理方式，将每个设备的采集值视为一个点位，类似于物模型的简单配置，只配置为属性。对于服务调用，实际上是写入值（write）。事件可以在规则中进行配置。

对于协议等内容，以及推送到其他平台的需求，我们可以按照与我们平台相似的方式，通过插件的形式来实现。

在完成上述工作后，可以考虑使用插件实现规则，或者根据我们平台的方式进行规则的开发。

对于硬件厂家而言，网关的配置方式应该是一致的，因此配置的导出和导入功能可能是很重要的。



## 后端开发语言选择

|          | Rust                                                         | C                                                            | C++                                                          | Golang                                                   |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------------------------- |
| 语言特性 | - 内存安全<br>- 并发性支持<br>- 零成本抽象<br>- 强大的类型系统 | - 直接访问硬件<br>- 高效的代码生成<br>- 可以进行底层编程     | - 支持面向对象编程<br>- 强大的标准库<br>- 跨平台性能         | - 并发性支持<br>- 垃圾回收<br>- 简洁的语法               |
| 生态系统 | - 活跃的社区支持<br>- 强大的包管理器（Cargo）<br>- 大量的第三方库 | - 历史悠久的语言<br>- 大量的现有代码可复用<br>- 可以直接调用底层系统接口 | - 丰富的开发工具<br>- 大量的开源项目<br>- 可以进行跨平台开发 | - 强大的标准库<br>- 快速构建可扩展的网络服务<br>- 轻量级 |
| 性能     | - 高性能<br>- 低开销的内存管理<br>- 零成本抽象的优化         | - 直接访问硬件<br>- 优化性能的可能性更高                     | - 高性能<br>- 优化的编译器<br>- 可以使用底层编程技术         | - 高性能的垃圾回收<br>- 并发编程的优化                   |
| 开发效率 | - 简洁的语法<br>- 强大的工具链<br>- 函数式编程风格           | - 直接访问硬件<br>- 简单的语法                               | - 面向对象编程的优势<br>- 可复用的组件                       | - 简洁的语法<br>- 轻量级<br>- 并发编程的优势             |
| 可维护性 | - 内存安全性<br>- 强大的类型系统<br>- 静态类型检查           | - 易于理解和维护的代码<br>- 可以进行低级优化                 | - 面向对象编程的优势<br>- 容易重构和扩展                     | - 简洁的语法<br>- 易于阅读和维护                         |
| 社区支持 | - 活跃的社区<br>- 文档丰富<br>- 开发者友好的社区氛围         | - 丰富的资源<br>- 大量的现有代码可供参考                     | - 庞大的开发者社区<br>- 成熟的工具和库                       | - 热门的                                                 |
| CPU内存  | \- 低消耗<br/>- 高效的内存管理<br/>- 良好的资源利用          | \- 直接访问硬件<br/>- 可以进行底层优化                       | \- 可以进行底层优化<br/>- 控制内存使用                       | \- 适中的消耗<br/>- 垃圾回收可能引起波动                 |

从语言的角度来看，C 语言在性能方面表现最佳，但其库管理等方面不占优势。C 和 C++ 的指针一直是内存问题的主要来源，在长时间不重启的边缘环境中尤其重要。Golang 使用垃圾回收机制进行内存管理，也存在一些问题。Rust 的内存安全和零成本抽象是其天然优势。

从造轮子的角度来看，C 和 C++ 的轮子已经非常成熟，并且存在一些严重的内存问题。Golang 在替代 Java 方面表现良好，但在边缘低功耗资源有限的环境中可能有些吃力。对于 Rust 来说，近年来各种系统内核以及大公司开始重用 Rust 进行代码重构，甚至 Windows 系统也在使用 Rust 进行重写。Rust 社区逐渐活跃起来，语言设计巧妙，具备零成本抽象的特点。目前，在边缘计算相关的开源项目方面仍有很大的空白。此外，随着 Rust 官方社区开始积极维护和打造嵌入式开发工具，许多嵌入式行业从业者开始学习 Rust，正好缺少一款像样的边缘网关产品。

## 产品设计和UI的重要性

对于这种简单的系统，好的设计和优雅的界面可以吸引对这个行业感兴趣的人一起参与并做出贡献。此外，还需要给这个产品起一个合适的名称。

## 学习开发项目地址

当前已完成的工作有：

1. 后端基础工程搭建和框架选型。
2. 简单的产品增删改查功能。
3. 插件的动态库扩展技术实现。

项目地址：https://github.com/dingdaoyi/LotusBridge.git

目前，该工程的打包后的大小约为 10MB 左右，并且内存占用也在 10MB 左右，满足市面上大多数开发板的要求。

Rust 后端的学习门槛可能会有些高，因此需要边学边做。目前的情况是功能先实现，性能可以等有想法的专家参与后进行优化。值得一提的是，只要 Rust 的代码能够运行，性能就不会差。

## 后续工作计划

1. 集成各种协议插件。
2. 进行页面设计，实现前端部分。可以先使用 JavaScript 实现页面，后续再改用 Rust 接口请求 WebAssembly 进行实现。
3. 进行硬件测试，测试几个厂家的硬件，并完成相关项目。
4. 通过 DIV 硬件推广来推广产品。
5. 开发简单的手机应用程序，自动发现本地局域网服务器，并查看设备等信息。



